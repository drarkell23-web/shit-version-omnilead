<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin — OmniSolutions</title><link rel="stylesheet" href="theme.css"></head>
<body>
<div class="admin-shell">
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <div>Badge/Icon Library: <select id="badgeSelect"><option value="">— select —</option></select></div>
      <button id="themeEditorBtn" class="btn">Theme Editor</button>
    </div>
  </header>

  <main class="admin-main">
    <section class="card">
      <h3>Contractors</h3>
      <div id="contractorsAdminList"></div>
    </section>

    <section class="card">
      <h3>Leads</h3>
      <div id="leadsAdminList"></div>
    </section>

    <section class="card">
      <h3>Actions</h3>
      <div>
        <label>Admin override token<input id="overrideToken" class="small-input"></label>
        <label>Admin override chat id<input id="overrideChat" class="small-input"></label>
        <button id="saveOverride" class="btn">Save override (logs change)</button>
      </div>
      <hr>
      <div>
        <h4>Subscription controls</h4>
        <div>Set subscription: <select id="subPlan"><option value="free">Free</option><option value="monthly_299">Monthly R299</option><option value="monthly_499">Monthly R499 (Premium)</option></select></div>
        <button id="applySub" class="btn">Apply (UI demo)</button>
      </div>
    </section>
  </main>
</div>

<!-- theme modal -->
<div id="adminThemeModal" class="hidden" style="position:fixed;right:18px;top:100px;background:var(--panel);padding:12px;border-radius:12px;z-index:9999">
  <h4>Admin Theme Editor</h4>
  <label>Accent color: <input id="adminAccent" type="color" value="#7b61ff"/></label><br><br>
  <input id="adminGradient" type="range" min="0" max="360" value="260"><label>Hue</label><br><br>
  <button id="applyAdminTheme" class="btn">Apply</button>
  <button id="closeAdminTheme" class="btn">Close</button>
</div>

<script>
async function loadAdmin() {
  const leads = await fetch('/api/logs/leads').then(r=>r.json()).catch(()=>[]);
  const contractors = await fetch('/api/logs/contractors').then(r=>r.json()).catch(()=>[]);
  document.getElementById('leadsAdminList').innerHTML = leads.slice(0,30).map(l=>`<div class="mini">${l.ts} — ${l.name||'-'} — ${l.phone||'-'} — ${l.service||'-'} </div>`).join('');
  document.getElementById('contractorsAdminList').innerHTML = contractors.slice(0,50).map(c=>`<div class="mini">${c.ts} — ${c.company||c.name||'-'} — ${c.phone||'-'} — ${c.service||'-'} <button class="btn" onclick="deactivate('${c.id||c.phone||c.ts}')">Deactivate</button> <button class='btn' onclick="editContractor('${c.id||c.phone||c.ts}')">Edit</button></div>`).join('');
}
function deactivate(id){ if(confirm('Deactivate contractor?')) alert('Deactivated (demo). For real, call server endpoint to update DB.'); }
function editContractor(id){ window.location.href = `/contractor-dashboard.html`; }

document.getElementById('saveOverride').addEventListener('click', async ()=>{
  const token = document.getElementById('overrideToken').value;
  const chat = document.getElementById('overrideChat').value;
  await fetch('/api/set-override', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ adminSecret: prompt('Admin secret:'), overrideToken: token, overrideChatId: chat })});
  alert('Override logged. To persist, update Render environment variables.');
});
document.getElementById('applySub').addEventListener('click', ()=> alert('Subscription applied (demo). Integrate payment gateway to charge.)');

document.getElementById('themeEditorBtn').addEventListener('click', ()=> document.getElementById('adminThemeModal').classList.remove('hidden'));
document.getElementById('closeAdminTheme').addEventListener('click', ()=> document.getElementById('adminThemeModal').classList.add('hidden'));
document.getElementById('applyAdminTheme').addEventListener('click', ()=> {
  const accent = document.getElementById('adminAccent').value;
  document.documentElement.style.setProperty('--accent', accent);
  alert('Theme applied locally. To persist site-wide store the style server-side.');
});

window.addEventListener('load', loadAdmin);
</script>
</body>
</html>
